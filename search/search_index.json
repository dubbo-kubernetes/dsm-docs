{"config":{"lang":["en","zh"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":""},{"location":"#redirecting","title":"Redirecting...","text":"<p>Click here if you are not redirected.</p>"},{"location":"overview/","title":"\u6982\u8ff0","text":"<p>Dubbo Service Mesh\uff08DSM\uff09\u662f\u901a\u8fc7 xDS \u534f\u8bae\u5b9e\u73b0\u7684 Dubbo \u670d\u52a1\u7f51\u683c\u6a21\u578b\u3002\u8be5\u6a21\u578b\u4e0d\u9700\u8981\u4ee3\u7406\uff0c\u63a7\u5236\u5e73\u9762\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 xDS \u5411 gRPC \u670d\u52a1\u4e0b\u53d1\u7b56\u7565\uff0c\u5b9e\u73b0\u4e0e gRPC \u670d\u52a1\u7684\u76f4\u63a5\u901a\u4fe1\u3002</p> <p>\u867d\u7136\u4e0d\u4f7f\u7528 proxy \u8fdb\u884c\u6570\u636e\u5e73\u9762\u901a\u4fe1\uff0c\u4f46\u4ecd\u7136\u9700\u8981\u4e00\u4e2a agent \u8d1f\u8d23\u521d\u59cb\u5316\uff0c\u5e76\u4e0e\u63a7\u5236\u5e73\u9762\u8fdb\u884c\u901a\u4fe1\u3002</p>"},{"location":"overview/#_2","title":"\u67b6\u6784\u6982\u89c8","text":"<p>\u76ee\u524d\u5904\u4e8e\u521d\u6b65\u8bbe\u8ba1\u5b9e\u9a8c\u9636\u6bb5\u3002\u540e\u7eed\u6807\u51c6\u529f\u80fd\u4f1a\u9010\u6b65\u5b8c\u5584\u548c\u652f\u6301\u3002</p>"},{"location":"overview/getting_started/","title":"\u5165\u95e8","text":"<p>\u8f6c\u5230 Dubbo \u53d1\u5e03\u9875\u9762\uff0c\u81ea\u52a8\u4e0b\u8f7d\u9002\u7528\u4e8e\u60a8\u64cd\u4f5c\u7cfb\u7edf\u7684\u5b89\u88c5\u6587\u4ef6\u5e76\u83b7\u53d6\u6700\u65b0\u7248\u672c\uff08Linux \u6216 macOS\uff09\uff1a</p> <pre><code>curl -L https://dubbo.apache.org/downloadDubbo | sh -\n</code></pre> <p>\u8f6c\u5230 Dubbo \u5305\u76ee\u5f55\uff1a</p> <pre><code>cd dubbo-0.3.5\n</code></pre> <p>\u4f7f\u7528 default \u914d\u7f6e\u6587\u4ef6\u5b89\u88c5 Dubbo\uff1a</p> <pre><code>dubboctl install --set profile=default\n</code></pre>"},{"location":"setup/install/dubboctl/","title":"Dubboctl","text":"<p>\u672c\u5b89\u88c5\u6307\u5357\u4f7f\u7528\u547d\u4ee4\u884c\u5de5\u5177 dubboctl\uff0c\u5b83\u63d0\u4f9b\u4e30\u5bcc\u7684\u5b9a\u5236 Dubbo \u63a7\u5236\u5e73\u9762\u4ee5\u53ca\u6570\u636e\u5e73\u9762 adapter\u3002\u53ef\u4ee5\u9009\u53d6\u4efb\u610f\u4e00\u4e2a Dubbo \u5185\u7f6e\u7684\u914d\u7f6e\u6863\uff0c\u4e3a\u60a8\u7684\u7279\u5b9a\u9700\u6c42\u8fdb\u4e00\u6b65\u5b9a\u5236\u914d\u7f6e\u3002</p> <p>dubboctl \u547d\u4ee4\u901a\u8fc7\u547d\u4ee4\u884c\u7684\u9009\u9879\u652f\u6301\u5b8c\u6574\u7684 DubboOperator API\uff0c\u8fd9\u4e9b\u9009\u9879\u7528\u4e8e\u5355\u72ec\u8bbe\u7f6e\u3001\u4ee5\u53ca\u63a5\u6536\u5305\u542b DubboOperator \u5b9a\u5236\u8d44\u6e90\uff08CR\uff09\u7684 yaml \u6587\u4ef6\u3002</p>"},{"location":"setup/install/dubboctl/#_1","title":"\u5148\u51b3\u6761\u4ef6","text":"<p>\u5f00\u59cb\u4e4b\u524d\uff0c\u68c0\u67e5\u4e0b\u5217\u5148\u51b3\u6761\u4ef6:</p> <ol> <li>\u4e0b\u8f7d Dubbod \u53d1\u884c\u7248</li> </ol>"},{"location":"setup/install/dubboctl/#dubbo","title":"\u4f7f\u7528\u914d\u7f6e\u6863\u5b89\u88c5 Dubbo","text":"<p><pre><code>dubboctl install -y\n</code></pre> \u6b64\u547d\u4ee4\u5728 Kubernetes \u96c6\u7fa4\u4e0a\u5b89\u88c5 default \u914d\u7f6e\u6863\u3002</p> <p>\u53ef\u4ee5\u9009\u53d6\u4efb\u610f\u4e00\u4e2a dubbo \u5185\u7f6e\u7684\u914d\u7f6e\u6863 <pre><code>dubboctl install --set profile=demo\n</code></pre> \u53ef\u4ee5\u901a\u8fc7\u5728\u547d\u4ee4\u884c\u4f20\u9012\u914d\u7f6e\u6863\u540d\u79f0\u7684\u65b9\u5f0f\uff0c\u5b89\u88c5\u5230\u96c6\u7fa4\u3002</p>"},{"location":"setup/install/dubboctl/#_2","title":"\u5b89\u88c5\u524d\u751f\u6210\u6e05\u5355\u6587\u4ef6","text":"<pre><code>dubboctl manifest generate &gt; $HOME/generated-manifest.yaml\n</code></pre>"},{"location":"setup/install/dubboctl/#_3","title":"\u5378\u8f7d","text":"<p>\u8981\u4ece\u96c6\u7fa4\u4e2d\u5b8c\u6574\u5378\u8f7d Dubbo\uff0c\u8fd0\u884c\u4e0b\u9762\u547d\u4ee4 <pre><code>istioctl uninstall --remove -y\n</code></pre> \u5c06\u79fb\u9664\u6240\u6709 Dubbo \u8d44\u6e90,\u540e\u7eed\u7248\u672c\u5c06\u4f1a\u652f\u6301\u6307\u5b9a\u6587\u4ef6\u3002</p> <p>\u547d\u540d\u7a7a\u95f4 dubbo-system \u9ed8\u8ba4\u4e0d\u4f1a\u88ab\u79fb\u9664\u3002\u5982\u679c\u4e0d\u518d\u9700\u8981\u7528\u4e0b\u9762\u547d\u4ee4\u79fb\u9664\u8be5\u547d\u540d\u7a7a\u95f4 <pre><code>kubectl delete namespace dubbo-system\n</code></pre></p>"},{"location":"setup/install/helm/","title":"Helm","text":"<p>\u8bf7\u9075\u5faa\u672c\u6307\u5357\u4f7f\u7528 Helm \u5b89\u88c5\u548c\u914d\u7f6e Dubbo \u7f51\u683c\u3002</p>"},{"location":"setup/install/helm/#_1","title":"\u5148\u51b3\u6761\u4ef6","text":"<pre><code>helm repo add dubbo https://charts.dubbo.apache.org\nhelm repo update\n</code></pre>"},{"location":"setup/install/helm/#_2","title":"\u5b89\u88c5\u6b65\u9aa4","text":"<ol> <li> <p>\u5b89\u88c5 Dubbo Base Chart\uff0c\u5b83\u5305\u542b\u4e86\u96c6\u7fa4\u8303\u56f4\u7684\u81ea\u5b9a\u4e49\u8d44\u6e90\u5b9a\u4e49 (CRD)\uff0c\u8fd9\u4e9b\u8d44\u6e90\u5fc5\u987b\u5728\u90e8\u7f72 Dubbo \u63a7\u5236\u5e73\u9762\u4e4b\u524d\u5b89\u88c5\uff1a <pre><code>helm install dubbo-base dubbo/base -n dubbo-system --create-namespace\n</code></pre></p> </li> <li> <p>\u5b89\u88c5 Dubbo Discovery Chart\uff0c\u5b83\u7528\u4e8e\u90e8\u7f72 dubbo \u7684\u670d\u52a1\uff1a <pre><code>helm install istiod dubbo/dubbod -n dubbo-system --wait\n</code></pre></p> </li> </ol>"},{"location":"setup/install/helm/#_3","title":"\u5378\u8f7d","text":"<ol> <li> <p>\u5217\u51fa\u5728\u547d\u540d\u7a7a\u95f4 dubbo-system \u4e2d\u5b89\u88c5\u7684\u6240\u6709 Dubbo Chart <pre><code>helm ls -n dubbo-system\n</code></pre></p> </li> <li> <p>\u5220\u9664 Dubbo Base Chart\uff1a <pre><code>helm delete dubbo-base -n dubbo-system\n</code></pre></p> </li> <li> <p>\u5220\u9664 Dubbo Discovery Chart\uff1a <pre><code>helm delete dubbod\n</code></pre></p> </li> <li> <p>\u5220\u9664\u547d\u540d\u7a7a\u95f4 dubbo-system\uff1a <pre><code>kubectl delete namespace dubbo-system\n</code></pre></p> </li> </ol>"},{"location":"tasks/security/mtls/","title":"\u53cc\u5411 TLS","text":"<p>\u672c\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u4f7f\u7528 DSM \u90e8\u7f72\u652f\u6301\u7684 gRPC \u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u53cc\u5411 TLS\u3002</p>"},{"location":"tasks/security/mtls/#_1","title":"\u6982\u8ff0","text":"<ul> <li>\u63d0\u4f9b\u8005\uff1a\u4e00\u4e2a gRPC \u670d\u52a1\u5668\uff0c\u63a5\u6536\u8bf7\u6c42\uff08\u7aef\u53e3 17070\uff09\uff0c\u5e76\u90e8\u7f72\u4e86\u591a\u4e2a\u7248\u672c\uff08v1/v2\uff09\uff0c\u4ee5\u5c55\u793a\u7070\u8272\u53d1\u5e03\u573a\u666f\u3002</li> <li>\u6d88\u8d39\u8005\uff1a\u4e00\u4e2a gRPC \u5ba2\u6237\u7aef\uff0c\u5411\u63d0\u4f9b\u8005\u670d\u52a1\u53d1\u9001\u8bf7\u6c42\uff0c\u5e76\u66b4\u9732\u4e00\u4e2a\u6d4b\u8bd5\u670d\u52a1\u5668\uff08\u7aef\u53e3 17171\uff09\uff0c\u7528\u4e8e\u901a\u8fc7 grpcurl \u7ba1\u7406\u6d41\u91cf\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u670d\u52a1\u90fd\u4f7f\u7528\u539f\u751f gRPC xDS \u5ba2\u6237\u7aef\u901a\u8fc7 dubbo-proxy \u8fde\u63a5\u5230 Dubbo \u63a7\u5236\u5e73\u9762\uff0c\u4ece\u800c\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u6d41\u91cf\u7ba1\u7406\u3002</p>"},{"location":"tasks/security/mtls/#_2","title":"\u524d\u63d0\u6761\u4ef6","text":"<ol> <li>\u5df2\u5b89\u88c5 Dubbo \u63a7\u5236\u5e73\u9762\u7684 Kubernetes \u96c6\u7fa4</li> <li>\u5df2\u914d\u7f6e kubectl \u4ee5\u8bbf\u95ee\u96c6\u7fa4</li> <li>grpcurl\uff08\u53ef\u9009\uff0c\u7528\u4e8e\u6d4b\u8bd5\uff09</li> </ol>"},{"location":"tasks/security/mtls/#_3","title":"\u90e8\u7f72","text":""},{"location":"tasks/security/mtls/#1","title":"1. \u521b\u5efa\u547d\u540d\u7a7a\u95f4","text":"<pre><code>kubectl create ns grpc-app\nkubectl label namespace grpc-app dubbo-injection=enabled\n</code></pre>"},{"location":"tasks/security/mtls/#2","title":"2. \u90e8\u7f72\u670d\u52a1","text":"<pre><code>kubectl apply -f grpc-app.yaml\n</code></pre>"},{"location":"tasks/security/mtls/#3","title":"3. \u6d4b\u8bd5\u670d\u52a1","text":"<pre><code>kubectl port-forward -n grpc-app $(kubectl get pod -l app=consumer -n grpc-app -o jsonpath='{.items[0].metadata.name}') 17171:17171\n</code></pre> <pre><code>grpcurl -plaintext -d '{\"url\": \"xds:///provider.grpc-app.svc.cluster.local:7070\",\"count\": 5}' localhost:17171 echo.EchoTestService/ForwardEcho\n</code></pre> <pre><code>{\n  \"output\": [\n    \"[0 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n    \"[1 body] Hostname=provider-v1-fbb7b9bd9-l8frj ServiceVersion=v1 Namespace=grpc-app IP=192.168.219.119 ServicePort=17070\",\n    \"[2 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n    \"[3 body] Hostname=provider-v1-fbb7b9bd9-l8frj ServiceVersion=v1 Namespace=grpc-app IP=192.168.219.119 ServicePort=17070\",\n    \"[4 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\"\n  ]\n}\n</code></pre>"},{"location":"tasks/security/mtls/#mtls","title":"\u542f\u7528 mTLS","text":"<p>\u7531\u4e8e\u5728 gRPC \u4e2d\u542f\u7528\u5b89\u5168\u529f\u80fd\u9700\u8981\u5bf9\u5e94\u7528\u7a0b\u5e8f\u672c\u8eab\u8fdb\u884c\u66f4\u6539\uff0cDubbo Kubernetes \u4f20\u7edf\u7684\u81ea\u52a8\u68c0\u6d4b mTLS \u652f\u6301\u7684\u65b9\u6cd5\u4e0d\u518d\u53ef\u9760\u3002\u56e0\u6b64\uff0c\u521d\u59cb\u7248\u672c\u8981\u6c42\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u7aef\u663e\u5f0f\u542f\u7528 mTLS\u3002</p>"},{"location":"tasks/security/mtls/#mtls_1","title":"\u542f\u7528\u5ba2\u6237\u7aef mTLS","text":"<p>\u8981\u542f\u7528\u5ba2\u6237\u7aef mTLS\uff0c\u8bf7\u5e94\u7528\u5e26\u6709 <code>tls</code> \u8bbe\u7f6e\u7684 <code>DestinationRule</code>\uff1a</p> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.dubbo.apache.org/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: provider-mtls\n  namespace: grpc-app\nspec:\n  host: provider.grpc-app.svc.cluster.local\n  trafficPolicy:\n    tls:\n      mode: DUBBO_MUTUAL\nEOF\n</code></pre> <p>\u73b0\u5728\uff0c\u5c1d\u8bd5\u8c03\u7528\u5c1a\u672a\u914d\u7f6e mTLS \u7684\u670d\u52a1\u5668\u5c06\u4f1a\u5931\u8d25\uff1a</p> <pre><code>grpcurl -plaintext -d '{\"url\": \"xds:///provider.grpc-app.svc.cluster.local:7070\",\"count\": 5}' localhost:17171 echo.EchoTestService/ForwardEcho\n</code></pre> <p>\u9884\u671f\u9519\u8bef\u8f93\u51fa\uff1a <pre><code>{\n   \"output\": [\n      \"ERROR:\\nCode: Unknown\\nMessage: 5/5 requests had errors; first error: rpc error: code = Unavailable desc = connection error: desc = \\\"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\\\"\",\n      \"[0] Error: rpc error: code = Unavailable desc = connection error: desc = \\\"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\\\"\",\n      \"[1] Error: rpc error: code = Unavailable desc = connection error: desc = \\\"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\\\"\",\n      \"[2] Error: rpc error: code = Unavailable desc = connection error: desc = \\\"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\\\"\",\n      \"[3] Error: rpc error: code = Unavailable desc = connection error: desc = \\\"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\\\"\",\n      \"[4] Error: rpc error: code = Unavailable desc = connection error: desc = \\\"transport: authentication handshake failed: tls: first record does not look like a TLS handshake\\\"\"\n   ]\n}\n</code></pre></p>"},{"location":"tasks/security/mtls/#mtls_2","title":"\u542f\u7528\u670d\u52a1\u5668\u7aef mTLS","text":"<p>\u8981\u542f\u7528\u670d\u52a1\u5668\u7aef mTLS\uff0c\u8bf7\u5e94\u7528 <code>PeerAuthentication</code> \u7b56\u7565\u3002\u4ee5\u4e0b\u7b56\u7565\u5c06\u5f3a\u5236\u6574\u4e2a\u547d\u540d\u7a7a\u95f4\u4f7f\u7528\u4e25\u683c\u7684 mTLS\uff1a</p> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: security.dubbo.apache.org/v1alpha3\nkind: PeerAuthentication\nmetadata:\n  name: provider-mtls\n  namespace: grpc-app\nspec:\n  mtls:\n    mode: STRICT\nEOF\n</code></pre> <p>\u5e94\u7528\u8be5\u7b56\u7565\u540e\uff0c\u8bf7\u6c42\u5c06\u5f00\u59cb\u6210\u529f\uff1a</p> <pre><code>grpcurl -plaintext -d '{\"url\": \"xds:///provider.grpc-app.svc.cluster.local:7070\",\"count\": 5}' localhost:17171 echo.EchoTestService/ForwardEcho\n</code></pre> <p>\u9884\u671f\u6210\u529f\u8f93\u51fa\uff1a <pre><code>{\n   \"output\": [\n      \"[0 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n      \"[1 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n      \"[2 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n      \"[3 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n      \"[4 body] Hostname=provider-v1-fbb7b9bd9-l8frj ServiceVersion=v1 Namespace=grpc-app IP=192.168.219.119 ServicePort=17070\"\n   ]\n}\n</code></pre></p>"},{"location":"tasks/traffic/canary/canary/","title":"\u6d41\u91cf\u5207\u5206","text":"<p>\u672c\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u4f7f\u7528 DSM \u90e8\u7f72\u652f\u6301\u7684 gRPC \u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u6d41\u91cf\u5207\u5206\u3002</p>"},{"location":"tasks/traffic/canary/canary/#_2","title":"\u6982\u8ff0","text":"<ul> <li>\u63d0\u4f9b\u8005\uff1a\u4e00\u4e2a gRPC \u670d\u52a1\u5668\uff0c\u63a5\u6536\u8bf7\u6c42\uff08\u7aef\u53e3 17070\uff09\uff0c\u5e76\u90e8\u7f72\u4e86\u591a\u4e2a\u7248\u672c\uff08v1/v2\uff09\uff0c\u4ee5\u5c55\u793a\u7070\u8272\u53d1\u5e03\u573a\u666f\u3002</li> <li>\u6d88\u8d39\u8005\uff1a\u4e00\u4e2a gRPC \u5ba2\u6237\u7aef\uff0c\u5411\u63d0\u4f9b\u8005\u670d\u52a1\u53d1\u9001\u8bf7\u6c42\uff0c\u5e76\u66b4\u9732\u4e00\u4e2a\u6d4b\u8bd5\u670d\u52a1\u5668\uff08\u7aef\u53e3 17171\uff09\uff0c\u7528\u4e8e\u901a\u8fc7 <code>grpcurl</code> \u7ba1\u7406\u6d41\u91cf\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u670d\u52a1\u90fd\u4f7f\u7528\u539f\u751f gRPC xDS \u5ba2\u6237\u7aef\u901a\u8fc7 <code>dubbo-proxy</code> \u8fde\u63a5\u5230 Dubbo \u63a7\u5236\u5e73\u9762\uff0c\u4ece\u800c\u5b9e\u73b0\u670d\u52a1\u53d1\u73b0\u3001\u8d1f\u8f7d\u5747\u8861\u548c\u6d41\u91cf\u7ba1\u7406\u3002</p>"},{"location":"tasks/traffic/canary/canary/#_3","title":"\u524d\u63d0\u6761\u4ef6","text":"<ol> <li>\u5df2\u5b89\u88c5 Dubbo \u63a7\u5236\u5e73\u9762\u7684 Kubernetes \u96c6\u7fa4</li> <li>\u5df2\u914d\u7f6e kubectl \u4ee5\u8bbf\u95ee\u96c6\u7fa4</li> <li>grpcurl\uff08\u53ef\u9009\uff0c\u7528\u4e8e\u6d4b\u8bd5\uff09</li> </ol>"},{"location":"tasks/traffic/canary/canary/#_4","title":"\u90e8\u7f72","text":""},{"location":"tasks/traffic/canary/canary/#1","title":"1. \u521b\u5efa\u547d\u540d\u7a7a\u95f4","text":"<pre><code>kubectl create ns grpc-app\nkubectl label namespace grpc-app dubbo-injection=enabled\n</code></pre>"},{"location":"tasks/traffic/canary/canary/#2","title":"2. \u90e8\u7f72\u670d\u52a1","text":"<pre><code>kubectl apply -f grpc-app.yaml\n</code></pre>"},{"location":"tasks/traffic/canary/canary/#3","title":"3. \u6d4b\u8bd5\u670d\u52a1","text":"<pre><code>kubectl port-forward -n grpc-app $(kubectl get pod -l app=consumer -n grpc-app -o jsonpath='{.items[0].metadata.name}') 17171:17171\n</code></pre> <pre><code>grpcurl -plaintext -d '{\"url\": \"xds:///provider.grpc-app.svc.cluster.local:7070\",\"count\": 5}' localhost:17171 echo.EchoTestService/ForwardEcho\n</code></pre> <pre><code>{\n  \"output\": [\n    \"[0 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n    \"[1 body] Hostname=provider-v1-fbb7b9bd9-l8frj ServiceVersion=v1 Namespace=grpc-app IP=192.168.219.119 ServicePort=17070\",\n    \"[2 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n    \"[3 body] Hostname=provider-v1-fbb7b9bd9-l8frj ServiceVersion=v1 Namespace=grpc-app IP=192.168.219.119 ServicePort=17070\",\n    \"[4 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\"\n  ]\n}\n</code></pre>"},{"location":"tasks/traffic/canary/canary/#_5","title":"\u4f7f\u7528\u76ee\u6807\u89c4\u5219\u521b\u5efa\u5b50\u96c6","text":"<p>\u9996\u5148\uff0c\u4e3a\u5de5\u4f5c\u8d1f\u8f7d\u7684\u6bcf\u4e2a\u7248\u672c\u521b\u5efa\u4e00\u4e2a\u5b50\u96c6\uff0c\u4ee5\u542f\u7528\u6d41\u91cf\u62c6\u5206\uff1a</p> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.dubbo.apache.org/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: provider-versions\n  namespace: grpc-app\nspec:\n  host: provider.grpc-app.svc.cluster.local\n  subsets:\n  - name: v1\n    labels:\n      version: v1\n  - name: v2\n    labels:\n      version: v2\nEOF\n</code></pre>"},{"location":"tasks/traffic/canary/canary/#_6","title":"\u6d41\u91cf\u5207\u5206","text":"<p>\u5229\u7528\u4e0a\u8ff0\u5b9a\u4e49\u7684\u5b50\u96c6\uff0c\u60a8\u53ef\u4ee5\u5c06\u4e0d\u540c\u6743\u91cd\u7684\u6d41\u91cf\u5206\u914d\u5230\u4e0d\u540c\u7684\u7248\u672c\u3002\u4ee5\u4e0b\u793a\u4f8b\u5c06 10% \u7684\u6d41\u91cf\u5206\u914d\u5230 v1\uff0c90% \u7684\u6d41\u91cf\u5206\u914d\u5230 v2\uff1a</p> <pre><code>cat &lt;&lt;EOF | kubectl apply -f -\napiVersion: networking.dubbo.apache.org/v1alpha3\nkind: VirtualService\nmetadata:\n  name: provider-weights\n  namespace: grpc-app\nspec:\n  hosts:\n  - provider.grpc-app.svc.cluster.local\n  http:\n  - route:\n    - destination:\n        host: provider.grpc-app.svc.cluster.local\n        subset: v1\n      weight: 10\n    - destination:\n        host: provider.grpc-app.svc.cluster.local\n        subset: v2\n      weight: 90\nEOF\n</code></pre> <p>\u73b0\u5728\uff0c\u53d1\u9001\u4e00\u7ec4 5 \u4e2a\u8bf7\u6c42\u6765\u9a8c\u8bc1\u6d41\u91cf\u5206\u5e03\u60c5\u51b5\uff1a</p> <pre><code>grpcurl -plaintext -d '{\"url\": \"xds:///provider.grpc-app.svc.cluster.local:7070\",\"count\": 5}' localhost:17171 echo.EchoTestService/ForwardEcho\n</code></pre> <p>\u54cd\u5e94\u5e94\u4e3b\u8981\u5305\u542b v2 \u54cd\u5e94\uff0c\u4ee5\u4f53\u73b0\u52a0\u6743\u6d41\u91cf\u62c6\u5206\uff1a <pre><code>{\n  \"output\": [\n    \"[0 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n    \"[1 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n    \"[2 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\",\n    \"[3 body] Hostname=provider-v1-fbb7b9bd9-l8frj ServiceVersion=v1 Namespace=grpc-app IP=192.168.219.119 ServicePort=17070\",\n    \"[4 body] Hostname=provider-v2-594b6977c8-5gw2z ServiceVersion=v2 Namespace=grpc-app IP=192.168.219.88 ServicePort=17070\"\n  ]\n}\n</code></pre></p>"},{"location":"tasks/traffic/canary/canary/#_7","title":"\u6e05\u7406","text":"<pre><code>kubectl delete -f grpc-app.yaml\nkubectl delete ns grpc-app\n</code></pre>"},{"location":"tasks/traffic/ingress/gateway-api/","title":"Kubernetes Gateway API","text":"<p>\u672c\u793a\u4f8b\u6f14\u793a\u5982\u4f55\u4f7f\u7528 DSM \u90e8\u7f72\u652f\u6301\u7684 httpbin \u670d\u52a1\uff0c\u5e76\u901a\u8fc7 Gateway API \u8fdb\u884c\u8bbf\u95ee\u3002</p>"},{"location":"tasks/traffic/ingress/gateway-api/#_1","title":"\u5148\u51b3\u6761\u4ef6","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u5b89\u88c5 Gateway API\u3002\u5982\u679c Gateway API CRD \u4e0d\u5b58\u5728\uff0c\u8bf7\u5b89\u88c5\uff1a <pre><code>kubectl get crd gateways.gateway.networking.k8s.io &amp;&gt; /dev/null || \\\n  { kubectl kustomize \"github.com/kubernetes-sigs/gateway-api/config/crd?ref=v1.4.0\" | kubectl apply -f -; }\n</code></pre></p>"},{"location":"tasks/traffic/ingress/gateway-api/#_2","title":"\u521b\u5efa\u670d\u52a1","text":"<pre><code>kubectl create -f https://raw.githubusercontent.com/apache/dubbo-kubernetes/master/samples/httpbin/httpbin.yaml\n</code></pre>"},{"location":"tasks/traffic/ingress/gateway-api/#_3","title":"\u521b\u5efa\u7f51\u5173","text":"<pre><code>kubectl create namespace dubbo-ingress\nkubectl apply -f - &lt;&lt;EOF\napiVersion: gateway.networking.k8s.io/v1\nkind: Gateway\nmetadata:\n  name: gateway\n  namespace: dubbo-ingress\nspec:\n  gatewayClassName: dubbo\n  listeners:\n  - name: default\n    hostname: \"*.example.com\"\n    port: 80\n    protocol: HTTP\n    allowedRoutes:\n      namespaces:\n        from: All\n---\napiVersion: gateway.networking.k8s.io/v1\nkind: HTTPRoute\nmetadata:\n  name: http\n  namespace: default\nspec:\n  parentRefs:\n  - name: gateway\n    namespace: dubbo-ingress\n  hostnames: [\"httpbin.example.com\"]\n  rules:\n  - matches:\n    - path:\n        type: PathPrefix\n        value: /get\n    backendRefs:\n    - name: httpbin\n      port: 8000\nEOF\n</code></pre>"},{"location":"tasks/traffic/ingress/gateway-api/#_4","title":"\u6d4b\u8bd5\u670d\u52a1","text":"<pre><code>NODE_IP=$(kubectl get nodes -o jsonpath='{.items[0].status.addresses[?(@.type==\"InternalIP\")].address}')\nSVC_PORT=$(kubectl get svc gateway-dubbo -n dubbo-ingress -o jsonpath='{.spec.ports[?(@.port==80)].nodePort}')\ncurl -s -I -HHost:httpbin.example.com \"http://$NODE_IP:$SVC_PORT/get\"\n</code></pre>"},{"location":"tasks/traffic/ingress/gateway-api/#_5","title":"\u6e05\u7406","text":"<pre><code>kubectl delete httproute http\nkubectl delete gateways.gateway.networking.k8s.io gateway -n dubbo-ingress\nkubectl delete ns dubbo-ingress\n</code></pre>"}]}